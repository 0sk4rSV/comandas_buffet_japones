<!DOCTYPE html>
<html lang="en">

<head>

    <title>Carta buffet libre Nakoya</title>

    <meta charset="utf-8">
    <meta name="description" content="Carta buffet libre Nakoya">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link href="css/main.css" rel="stylesheet">

    <!-- Bootstrap. -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap icons. -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">

    <!-- DataTables plug-in. -->
    <link href="css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="css/responsive.dataTables.min.css" rel="stylesheet">

    <!-- Tooltipster plugin -->
    <link href="css/tooltipster.bundle.min.css" rel="stylesheet">
    <link href="css/tooltipster-sideTip-borderless.min.css" rel="stylesheet">

</head>

<body>

    <div id="div-loading">
        <img id="img-loading" src=".images/loading_gif.svg" />
    </div>

    <header>
        <div class="container text-center">

            <div id="div-titulo">
                <h2>CARTA BUFFET LIBRE <a href="http://m.restaurantejaponesnakoya.com/col.jsp?id=112" target="_blank"
                        title="Enlace página buffet libre Nakoya.">NAKOYA</a></h2>
            </div>
        </div>
    </header>

    <div class="container">
        <fieldset class="mb-5 border rounded-3 p-3" id="fieldsetMenu">

            <!-- MENU -->
            <div id="divMenu" style="position: relative;">
                <fieldset class="mb-3 border rounded-3 p-3" style="box-shadow: -1px 6px 6px -5px rgba(0, 0, 0, 0.3);">
                    <legend class="w-auto px-2 float-none">MENÚ</legend>

                    <div class="table-responsive" id="divTablaMenu" style="display: none;">

                        <div style="margin-left: 4px;">
                            <div class="mb-3" id="divFiltrosMenu">
                                <label>Filtros:</label>

                                <div id="divSwitchesFiltros">
                                    <div class="form-check form-switch">
                                        <label class="form-check-label" for="switchFiltroFavoritos">Favoritos</label>
                                        <input class="form-check-input" type="checkbox" role="switch"
                                            id="switchFiltroFavoritos" title="Marcar favoritos.">

                                    </div>
                                    <div class="form-check form-switch">
                                        <label class="form-check-label" for="switchFiltroSushi">Sushi</label>
                                        <input class="form-check-input" type="checkbox" role="switch"
                                            id="switchFiltroSushi" title="Marcar sushi.">

                                    </div>
                                </div>

                            </div>

                            <div class="mb-3">
                                <button class="btn btn-sm btn-outline-primary" id="añadirHabituales"
                                    style="padding: 2px 6px;">Añadir pedidos habituales</button>
                            </div>

                            <hr style="opacity: 1; color: #273585;">
                        </div>

                        <table class="table table-sm table-hover table-bordered mb-0 w-100" id="tablaMenu">
                        </table>

                        <div id="footerMenu">
                            <div>
                                <p class="mt-3" id="pInfoMenu"><b>*</b> Los platos que llevan ⭐ solo están disponibles
                                    por la
                                    noche, fines
                                    de
                                    semana y festivos.</p>
                            </div>

                        </div>

                    </div>

                </fieldset>

                <button class="btn btn-primary btn-sm btn-rounded" id="btnPrincipioMenu"
                    title="Pulsa para volver al principio del menú." style="display: none;"><i
                        class="bi bi-arrow-up"></i></button>

            </div>

            <!-- LISTADO PEDIDOS -->
            <div id="divListaPedidos">
                <fieldset class="border rounded-3 p-3">
                    <legend class="w-auto px-2 float-none">LISTADO PEDIDOS</legend>

                    <div id="divPedidos">
                        <p id="pInfoSeleccionPlatos" class="mb-0"><i>Selecciona platos del menú de arriba para comenzar
                                con el pedido!</i></p>
                        <ul class="list-group" id="listaPedidos"></ul>
                    </div>

                    <div class="mt-3" id="divComplementariaPedidos" style="display: none;">

                        <span id="totalPedidos"><i class="bi bi-box-arrow-up-right" title="Ver pedido en modo discreto."
                                style="color:  #0d6efd;"></i>&nbsp;&nbsp;<span id="textoTotalPedidos"></span></span>

                        <div id="divComplementariaBtns">
                            <button class="btn btn-primary btn-sm btn-rounded" id="btnCopiarPedidos"
                                title="Copiar pedidos."><span class="tooltip"
                                    title="Listado copiado al portapapeles!"></span><i class="bi bi-files"></i></button>

                            <button class="btn btn-danger btn-sm btn-rounded" id="btnBorrarListaPedidos"
                                title="Borrar todo."><i class="bi bi-trash"></i></button>
                        </div>
                    </div>

                </fieldset>
            </div>

        </fieldset>

        <div class="accordion" id="accordionExample">
            <!-- POSTRES -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true"
                        aria-controls="panelsStayOpen-collapseOne">
                        POSTRES
                    </button>
                </h2>
                <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse"
                    aria-labelledby="panelsStayOpen-headingOne">
                    <div class="accordion-body" style="padding-bottom: 16px;">

                        <!-- INICIO CUERPO POSTRES -->
                        <div id="divPostres">
                            <div class="table-responsive" id="divTablaPostrres">
                                <table class="table table-sm table-bordered table-striped mb-0 w-100" id="tablaPostres">
                                </table>
                                <p class="mt-2" id="pInfoMenu"><b>*</b> Solo 1 postre por persona.</p>
                            </div>
                        </div>
                        <!-- FIN CUERPO POSTRES -->

                    </div>
                </div>
            </div>

            <!-- PRECIOS -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseTwo">
                        PRECIOS BUFFET
                    </button>
                </h2>
                <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse"
                    aria-labelledby="panelsStayOpen-headingTwo">
                    <div class="accordion-body" style="padding-bottom: 0px;">

                        <!-- INICIO CUERPO PRECIOS -->
                        <div id="divPrecios">
                            <div class="container">
                                <div class="row border-bottom">
                                    <label>MEDIODÍA:</label>
                                    <ul>
                                        <li><u>Adultos</u>: <b>13,80 &euro;</b></li>
                                        <li><u>Niños menores de 7 años</u>: <b>8,00 &euro;</b></li>
                                    </ul>
                                </div>

                                <div class="row border-bottom">
                                    <label style="padding-top: 12px;">NOCHES, FINES DE SEMANA Y
                                        FESTIVOS:</label>
                                    <ul>
                                        <li><u>Adultos</u>: <b>16,80 &euro;</b></li>
                                        <li><u>Niños menores de 7 años</u>: <b>9,50 &euro;</b></li>
                                    </ul>
                                </div>

                                <div class="row">
                                    <label style="padding-top: 12px;">BEBIDAS:<span id="spanInfoBebida"
                                            style="margin-left: 13px;">¡No abusar!</span></label>
                                    <ul>
                                        <li><u>Botella de agua grande</u>: <b>3,50 &euro;</b></li>
                                        <li><u>Lata de refresco</u>: <b>2,20 &euro;</b></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <!-- FIN CUERPO PRECIOS -->

                    </div>
                </div>
            </div>

            <!-- HORARIO -->
            <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingThree">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseThree">
                        HORARIO Y CONTACTO
                    </button>
                </h2>
                <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse"
                    aria-labelledby="panelsStayOpen-headingThree">
                    <div class="accordion-body">
                        <div class="text-center">
                            <label>TODOS LOS DÍAS</label>
                            <p class="mb-0">12:00 - 16:00</p>
                            <p>19:30 - 00:00</p>
                            <div id="divInfoContacto">
                                <p class="border-top mb-0" style="padding-top: 12px;">📞&nbsp;<b>Teléfono:</b> <a
                                        href="tel:960704136" target="_blank">960 70 41 36</a> - <a href="tel:685917657"
                                        target="_blank">685 91 76 57</a></p>
                                <p class="mb-0">🧭&nbsp;<b>Dirección:</b> <a
                                        href="https://goo.gl/maps/NCEefxuxbUPxLFX68" target="_blank">Pl. de Juan
                                        Grandia, 3,
                                        46340 Requena, Valencia</a></p>

                                <p class="mb-0">🌐&nbsp;<b>Página web:</b> <a
                                        href="http://m.restaurantejaponesnakoya.com"
                                        target="_blank">http://m.restaurantejaponesnakoya.com</a></p>
                            </div>
                        </div>


                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingFour">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseFour" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseFour">
                        HALL OF FAME 🏆
                    </button>
                </h2>
                <div id="panelsStayOpen-collapseFour" class="accordion-collapse collapse"
                    aria-labelledby="panelsStayOpen-headingFour">
                    <div class="accordion-body">
                        <div class="text-center" id="divPodio">
                            <!-- INICIO CUERPO PODIO -->
                            <img src="./images/podio.png" class="img-fluid" alt="Imágen podio.">
                            <!-- FIN CUERPO PODIO -->
                        </div>


                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingFive">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#panelsStayOpen-collapseFive" aria-expanded="false"
                        aria-controls="panelsStayOpen-collapseFive">
                        CONTADOR MAKI 🎰
                    </button>
                </h2>
                <div id="panelsStayOpen-collapseFive" class="accordion-collapse collapse"
                    aria-labelledby="panelsStayOpen-headingFive">
                    <div class="accordion-body">
                        <div class="text-center" id="divContadorMaki">
                            <!-- INICIO CUERPO CONTADOR MAKI -->

                            <p style="font-size: 14px; margin-bottom: 30px;">Pulsa el maki para incrementar el contador!
                            </p>

                            <div id="divImgMaki">
                                <img src="./images/maki_atun.png" id="imgMaki" alt="Imágen maki." draggable="false">


                            </div>

                            <div id="divBotoneraContadorMaki">
                                <button class="btn btn-primary btn-sm btn-rounded" id="btnDecrecer"
                                    title="Decrecer contador."><i class="bi bi-dash-lg"></i></button>

                                <span id="contador">0</span>

                                <button class="btn btn-danger btn-sm btn-rounded" id="btnReset"
                                    title="Resetear contador."><i class="bi bi-x-lg"></i></button>
                            </div>



                            <!-- FIN CUERPO CONTADOR MAKI -->
                        </div>


                    </div>
                </div>
            </div>


            <div class="mt-5" id="divTiempo">
                <p class="mb-1"><b>Fecha actual:</b> <span id="tiempoActual"></span></p>
                <p><span id="tiempoCierre"></span></p>
            </div>

        </div>

        <!-- FOOTER -->
        <div class="container">

            <div class="text-center my-2 border-top" id="div-footer">
                <p class="text-muted mb-0" id="copyright" style="margin-top: 8px;"></p>
                <div class="separador"></div>
            </div>

        </div>

        <button class="btn btn-primary" id="btn-back-to-top" type="button" onclick="topFunction()"
            title="Pulsa para volver arriba.">
            <i class="bi bi-arrow-up-short"></i>
        </button>

        <!-- MODAL PEDIDOS-->
        <div class="modal" id="modalPedido">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">LISTADO PEDIDOS 🕵️</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                            aria-label="Close"></button>

                    </div>
                    <div class="modal-body">
                        <div id="listadoPedidosModal"></div>
                    </div>
                    <div class="modal-footer" style="justify-content: space-between;">
                        <span id="totalPlatosModal"></span>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>


        <div></div>

</body>

<!-- JQUERY -->
<script src="js/jquery-3.6.4.min.js"></script>

<!-- DATATABLES PLUGIN -->
<script src="js/jquery.dataTables.min.js"></script>
<script src="js/dataTables.bootstrap5.min.js"></script>
<script src="js/dataTables.responsive.min.js"></script>
<script src="js/responsive.bootstrap5.min.js"></script>

<!-- BOOTSTRAP -->
<script src="js/bootstrap.min.js"></script>

<!-- TOOLTIPSTER PLUGIN -->
<script src="js/tooltipster.bundle.min.js"></script>


<script type="text/javascript">
    //VARIABLES GLOBALES

    //MAPA CON LOS PLATOS DEL MENU Y SU CORRESPONDIENTE CODIGO.
    const mapMenu = new Map([
        ["A0", "Tostada de gambas ⭐"],
        ["A1", "Rollo ternera con queso ⭐"],
        ["A2", "Ensalada de la casa (algas)"],
        ["A3", "Ensalada china de lechuga"],
        ["A4", "Ensalada china de col"],
        ["A5", "Sopa miso"],
        ["A7", "Sopa de aleta de tiburón"],
        ["A9", "Sopa de maíz con carne de cangrejo"],
        ["A6", "Rollito de gamba"],
        ["A10", "Rollitos vietnamitas"],
        ["A11", "Rollito de pollo con queso fundido"],
        ["A12", "Rollo de primavera"],
        ["A13", "Bola de queso ⭐"],
        ["A14", "Wan Tun frito"],
        ["A15", "Langostino crujiente ⭐"],
        ["A16", "Xiao Long Bao"],
        ["A17", "Bolas de arroz frito"],
        ["A18", "Pan japones frito"],
        ["A19", "Tempura atún"],
        ["A20", "Entrecot rollo con queso ⭐🥈"],
        ["A22", "Tempura langostinos"],
        ["A23", "Arroz teppanyaki"],
        ["A24", "Tallarines teppanyaki"],
        ["A25", "Teppanyaki de pollo"],
        ["A26", "Sau mai frito"],
        ["A27", "Teppanyaki de gambas ⭐"],
        ["A28", "Yakitori de gambas ⭐"],
        ["A31", "Triángulo de ternera con curry"],
        ["A33", "Teppanyaki de entrecot ⭐"],
        ["A41", "Arroz frito tres delicias"],
        ["A42", "Arroz de la casa"],
        ["A43", "Arroz coreano (picante)"],
        ["A44", "Tallarines tres delicias"],
        ["A47", "Fideos de arroz"],
        ["A50", "Pollo con sésamo"],
        ["A52", "Pollo con almendras"],
        ["A53", "Pollo al limón"],
        ["A54", "Pollo picante"],
        ["A55", "Bolas de pollo frito"],
        ["A57", "Carne de cerdo agridulce"],
        ["A58", "Gambas con bambú y setas ⭐"],
        ["A60", "Ternera con bambú y setas"],
        ["A61", "Ternera crujiente"],
        ["A66", "Pato \"PeKin\" ⭐"],
        ["A67", "Pato japonés ⭐🥉"],
        ["A69", "Pollo laqueado"],
        ["A70", "Gambas laqueado ⭐"],
        ["A74", "Empanadilla con carne"],
        ["A76", "Maki atún picante 🥇"],
        ["A78", "Sushi salmón y aguacate"],
        ["A79", "Maki de pollo desmenuzado ⭐"],
        ["A80", "Sushi atún"],
        ["A81", "Sushi variados"],
        ["A82", "Maki salmón y aguacate"],
        ["A83", "Maki palito de cangrejo, pepino y aguacate"],
        ["A84", "Maki pollo y mayonesa"],
        ["A85", "Maki salmón"],
        ["A86", "Maki atún"],
        ["A87", "Maki aguacate y pepino"],
        ["A88", "Ebi maki"],
        ["A89", "California maki"],
        ["A90", "Futo maki"],
        ["A91", "Tempura maki"],
        ["A92", "Salmón sashimi ⭐"],
        ["A93", "Sashimi atún ⭐"],
        ["A94", "Maki cono"],
        ["A95", "Tempura maki Nakoya"],
        ["A98", "Maki queso cremoso"],
        ["A99", "Tarta sushi ⭐"],
    ]);

    //MAPA CON LOS POSTRES.
    const mapPostres = new Map([
        ["1.", "Bola de helado (chocolate, fresa, vainilla o limón)"],
        ["2.", "Flan"],
        ["3.", "Plátano frito"],
        ["4.", "Pastel de calabaza con chocolate"],
        ["5.", "Mini rollito de plátano y chocolate (2 uds.)"],
        ["6.", "Profiteroles (2 uds.)"],
        ["7.", "Crepe con nata y chocolate"]
    ]);

    //VARIABLES EASTER EGG.
    let contadorClicks = 0;
    let ultimoTiempoClick = 0;

    var valorContador;

    $(document).ready(function () {



        $("body div:last").hide();

        //Creamos las tablas. 
        crearTablaMenu(mapMenu);
        crearTablaPostres(mapPostres);
        crearDataTable();

        document.getElementById("copyright").innerHTML = "&copy " + new Date().getFullYear() + ", Desarrollado por Tito's S.A. <span id='spanEE'>🍣<span>";

        // Función para guardar en caché
        function guardarEnCache() {
            var contenido = $('#listaPedidos').html();
            // Guardar los valores de los inputs junto con el HTML
            var valoresInputs = {};
            $('#listaPedidos input').each(function () {
                valoresInputs[$(this).closest('li').attr('id')] = $(this).val();
            });
            localStorage.setItem('contenidoListaPedidos', contenido);
            localStorage.setItem('valoresInputsListaPedidos', JSON.stringify(valoresInputs));
            localStorage.setItem('valorContador', $('#contador').text());
            var timestamp = new Date().getTime();
            localStorage.setItem('timestampListaPedidos', timestamp);
        }

        // Función para cargar desde caché
        function cargarDesdeCache() {
            var contenidoGuardado = localStorage.getItem('contenidoListaPedidos');
            var valoresInputsGuardados = JSON.parse(localStorage.getItem('valoresInputsListaPedidos'));
            contador = (localStorage.getItem('valorContador') != null ? localStorage.getItem('valorContador') : 0);
            $('#contador').text(contador);

            var timestampGuardado = localStorage.getItem('timestampListaPedidos');
            var timestampActual = new Date().getTime();
            if (contenidoGuardado && (timestampActual - timestampGuardado < 24 * 60 * 60 * 1000)) {
                $("#pInfoSeleccionPlatos").hide();
                $('#listaPedidos').html(contenidoGuardado);
                // Restaurar los valores de los inputs
                if (valoresInputsGuardados) {

                    $.each(valoresInputsGuardados, function (id, valor) {
                        $('#' + id + ' .inputCantPlato').val((valor != "" ? valor : "1"));
                    });
                }
                document.getElementById("textoTotalPedidos").innerHTML = "Platos seleccionados: <b>" + $("#divListaPedidos #listaPedidos li").length + "</b>";
                $("#divComplementariaPedidos").show();




            }

        }

        // Llamar a la función para cargar desde caché al cargar la página
        cargarDesdeCache();

        // Llamar a la función para guardar en caché al salir de la página o al recargar
        $(window).on('beforeunload', function () {
            guardarEnCache();
        });

        //Configuramos el plugin de Tooltipster para los tooltips.
        $(".tooltip").tooltipster({
            theme: ["tooltipster-borderless", "tooltipster-noir", "tooltipster-noir-customized"],
            maxWidth: 300,
            trigger: "click",
            timer: 1500,
            animation: "grow"
        });

    });

    //FUNCION PARA CREAR LA TABLA DEL MENU.
    function crearTablaMenu(mapMenu) {
        let tablaMenu = "<thead class='table-light'>" +
            "<tr class='align-middle'>" +
            "<th scope='col' style='display: none;'>ID_FILA</th>" +
            "<th scope='col' style='text-align:center; max-width:90px;'>NÚMERO</th>" +
            "<th scope='col'>PLATO</th>" +
            "</tr></thead><tbody>";

        for (let [key, value] of mapMenu.entries()) {
            let index = Array.from(mapMenu.keys()).indexOf(key);
            tablaMenu += "<tr class='align-middle'>" +
                "<td style='display: none;'>" + index + "</td>" +
                "<td align='center' style='font-weight: bold;'>" + key + "</td>" +
                "<td class='d-flex justify-content-between'><span class='align-self-start my-auto'>" + value + "</span><button class='btn btn-sm bg-transparent align-self-end my-auto btnImagenPlato' title='Buscar plato.'><i class='bi bi-image'></i></button></td>";
        }

        tablaMenu += "</tr></tbody>";

        document.getElementById("tablaMenu").innerHTML = tablaMenu;
    }

    //FUNCION PARA CREAR LA TABLA DE POSTRES.
    function crearTablaPostres(mapPostres) {

        let tablaPostres = "<thead style='display: none;>" +
            "<tr class='align-middle'>" +
            "<th scope='col' style='display: none;'>ID_FILA</th>" +
            "<th scope='col' style='text-align:center; width:90px;'>NÚMERO</th>" +
            "<th scope='col'>POSTRE</th>" +
            "</tr></thead><tbody>";

        // let tablaPostres = "<thead>";

        for (let [key, value] of mapPostres.entries()) {
            let index = Array.from(mapPostres.keys()).indexOf(key);
            tablaPostres += "<tr class='align-middle'>" +
                "<td style='display: none;'>" + index + "</td>" +
                "<td align='center' style='font-weight: bold; width: 36px;'>" + key + "</td>" +
                "<td class='d-flex justify-content-between'><span class='align-self-start my-auto'>" + value + "</span><button class='btn btn-sm bg-transparent align-self-end my-auto btnImagenPlato' title='Buscar plato.'><i class='bi bi-image'></i></button></td>";
        }

        tablaPostres += "</tr></tbody>";

        document.getElementById("tablaPostres").innerHTML = tablaPostres;
    }

    //ESTA FUNCION SE EJECUTA CUANDO TERMINA DE CARGAR LA PAGINA.
    $(window).on("load", function () {

    });

    //FUNCION PARA USAR EL PLUGIN DATATABLES Y DARLE FORMATO A LA TABLA DEL MENU.
    function crearDataTable() {

        //Configuracion del plug-in DataTables.
        table = $("#tablaMenu").DataTable({

            dom: "<'row'<'col-sm-12'f>>" +
                "<'row'<'col-sm-12'tr>>" +
                "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",

            columnDefs: [

                {
                    orderData: [0],
                    targets: [1]
                },

                {
                    orderable: false,
                    targets: [0]
                },

                //Ocultamos la primera(0)(NUMERO_FILA) columna.
                {
                    visible: false,
                    targets: [0]
                }

            ],

            paging: false,
            //info: false,
            rowId: '0',
            stateSave: false,
            language: {
                url: "https://cdn.datatables.net/plug-ins/1.12.1/i18n/es-ES.json",
                search: '<i class="bi bi-search"></i>',
                searchPlaceholder: "Buscar..."
            },

        });

        //** SOLUCION TEMPORAL PARA CORREGIR EL DESAJUSTE DEL ENCABEZADO DE LA TABLA Y LAS COLUMNAS AL INICIALIZAR DATATABLES.
        setTimeout(function () {
            table.columns.adjust().responsive.recalc();
            $("#divTablaMenu").show();
            $("#div-loading").hide();
        }, 480);

        //Borramos la cadena del filtro de bUsqueda cada vez que se cree la tabla.
        //$("#table").DataTable().search("").draw(false);

    }

    //FUNCION PARA RECALCULAR EL ANCHO DE LAS COLUMNAS RESPONSIVAS AL HACER ZOOM EN EL NAVEGADOR.
    window.onresize = function () {
        if (typeof table != "undefined") {
            table.columns.adjust().responsive.recalc();
        }
    }

    //LISTENER PARA REMARCAR LOS PLATOS FAVORITOS.
    $("#switchFiltroFavoritos").on("change", function () {
        const platosFavoritos = ["A15", "A20", "A22", "A28", "A43", "A50", "A53", "A57", "A61", "A67", "A76", "A80"];

        $("#switchFiltroSushi").prop("checked", false);
        $("td").closest("tr").removeClass("sushi");

        if ($(this).is(":checked")) {

            for (let i = 0; i < platosFavoritos.length; i++) {
                $("td:contains(" + platosFavoritos[i] + ")").closest("tr").addClass("fav");
            }

        } else {
            $("td").closest("tr").removeClass("fav");
        }

    });

    //LISTENER PARA REMARCAR LOS PLATOS DE SUSHI.
    $("#switchFiltroSushi").on("change", function () {
        const platosSushi = ["A76", "A78", "A79", "A80", "A81", "A82", "A83", "A84", "A85", "A86", "A87",
            "A88", "A89", "A90", "A91", "A92", "A93", "A94", "A95", "A96", "A98", "A99"];

        $("#switchFiltroFavoritos").prop("checked", false);
        $("td").closest("tr").removeClass("fav");

        if ($(this).is(":checked")) {

            for (let i = 0; i < platosSushi.length; i++) {
                $("td:contains(" + platosSushi[i] + ")").closest("tr").addClass("sushi");
            }

        } else {
            $("td").closest("tr").removeClass("sushi");
        }
    });

    //LISTENER PARA AÑADIR AL LISTADO DE PEDIDOS EL PLATO SELECCIONADO.
    $("body").on("click", "#tablaMenu tbody tr", function () {
        var index = $(this).index();
        var columna1 = $(this).find("td:eq(0)").text();
        var columna2 = $(this).find("td:eq(1)").text();

        var pedido = "<li id='pedido" + index + "' class='list-group-item' ><span class='spanPlatoCant'><b>" + columna1 + "</b> - " + "<input class='form-control inputCantPlato' type='number' inputmode='numeric' value='1' step='1' min='1' max='99' onkeypress='return isNumeric(event)' oninput='maxLengthCheck(this)' onchange='minCantValue(this)'>" + columna2 + "</span><div><button class='btn btn-sm bg-transparent align-self-end my-auto btnImagenPlato' title='Buscar plato.'><i class='bi bi-image'></i></button><button class='btn bg-transparent btnEliminarPedido' title='Eliminar pedido.'><i class='bi bi-x-lg'></i></button></div></li>";


        $("#pInfoSeleccionPlatos").hide();



        var arrayNumPlatos = [];

        // Selecciona todas las etiquetas <b> dentro del div con id="divPedidos"
        $("#divPedidos b").each(function () {
            arrayNumPlatos.push($(this).text());
        });

        if (!arrayNumPlatos.includes(columna1)) {

            $("#listaPedidos").append(pedido);
            document.getElementById("textoTotalPedidos").innerHTML = "Platos seleccionados: <b>" + $("#listaPedidos li").length + "</b>";



            mostrarAlerta("success", "Plato añadido<br><span class='platoAlerta'>("+ columna1 + " - " + columna2 + ")</span>");

        } else {

            mostrarAlerta("warning", "El plato ya está añadido<br><span class='platoAlerta'>("+ columna1 + " - " + columna2 + ")</span>");

        }

        console.log(columna1)
        console.log(pedido)

        $("#divComplementariaPedidos").show();







    });

    //Funcion para crear alertas dinamicas.
    function mostrarAlerta(tipoAlerta, textoAlerta) {
        //Verifica si hay una alerta visible y la elimina si la hay.
        $(".alert").remove();

        var icono = "";
        if (tipoAlerta == "success") {
            icono = "<i class='bi bi-check-circle-fill'></i>";
        } else if (tipoAlerta == "warning") {
            icono = "<i class='bi bi-exclamation-triangle-fill'></i>";
        } else if (tipoAlerta == "danger") {
            icono = "<i class='bi bi-exclamation-circle-fill'></i>";
        }

        // Creamos la alerta.
        var alert = $("<div id='divAlerta'>" + "<div class='alert alert-" + tipoAlerta + " alert-dismissible fade show' id='divContenidoAlerta' role='alert'>" + icono + "&nbsp;&nbsp;" + textoAlerta
            + "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>");

        //Agregamos la alerta al cuerpo del documento.
        $("body").append(alert);

        //Cierra la alerta automaticamente despues x segundos.
        setTimeout(function () {
            alert.fadeOut(750, function () {
                alert.remove();
            });
        }, 2500);

    }

    //Agrega un manejador de eventos para el boton "close" de las alertas.
    $('.btn-close').click(function () {
        alert.fadeOut(750, function () {
            alert.remove();
        });
    });




    //LISTENER PARA BUSCAR EN GOOGLE IMAGENES, EL PLATO DEL BOTON PULSADO. 
    $("body").on("click", ".btnImagenPlato", function (event) {
        event.stopPropagation();
        var plato = $(this).closest("tr").find("span").text().replace(/"/g, '').replace(/[^A-Za-z0-9áéíóúÁÉÍÓÚ.,\-:"'()\s]/g, '');


        //Si el boton de buscar plato es pulsado desde el listado de pedidos.
        if (plato === "") {
            var spanElement = $(this).parent().parent().find("span");
            var spanContent = spanElement.text().replace(/"/g, '').replace(/[^A-Za-z0-9áéíóúÁÉÍÓÚ.,\-:"'()\s]/g, '');


            plato = spanContent.replace(spanElement.find('b').text() + ' - ', '');

        }

        var url = "https://www.google.com/search?q=" + plato.toLowerCase() + "&tbm=isch";

        window.open(url, "_blank");
    });

    //LISTENER PARA ELIMINAR ELEMENTOS DEL LISTADO DE PEDIDOS.
    $("#divListaPedidos").on("click", "button.btnEliminarPedido", function () {
        var index = $(this).closest("li").index();
        $("#listaPedidos li").eq(index).remove();
        document.getElementById("textoTotalPedidos").innerHTML = "Platos seleccionados: <b>" + $("#listaPedidos li").length + "</b>";

        if ($("#listaPedidos li").length == 0) {
            $("#divComplementariaPedidos").hide();
            $("#pInfoSeleccionPlatos").show();
        }

    });

    //LISTENER DEL BOTON PARA COPIAR AL PORTAPAPELES EL LISTADO DE PEDIDOS.
    $("#divListaPedidos").on("click", "button#btnCopiarPedidos", function () {



        let textoCopiado = "";
        const elementosLista = $("#listaPedidos li");

        elementosLista.each(function (index) {
            let textoSpan = $(this).find("span").text().replace(/[^A-Za-z0-9áéíóúÁÉÍÓÚ.,-:"'\(\)\s]/g, '');

            let cantidadPlato = $(this).find("input").val();
            cantidadPlato = " ~ (" + cantidadPlato + (cantidadPlato > 1 ? " uds." : "ud.") + ")";

            textoCopiado += textoSpan + cantidadPlato;

            if (index !== elementosLista.length - 1) {
                textoCopiado += "\n";
            }
        });

        //Copiar el texto al portapapeles
        navigator.clipboard.writeText(textoCopiado);

        $(".tooltip").tooltipster("open");

    });

    //LISTENER PARA ELIMINAR TODOS LOS PLATOS DEL LISTADO DE PEDIDOS.
    $("#divListaPedidos").on("click", "button#btnBorrarListaPedidos", function () {
        $("#listaPedidos").empty();
        $("#divComplementariaPedidos").hide();
        $("#pInfoSeleccionPlatos").show();
    });

    //LISTENER PARA AÑADIR AL LISTADO LOS PLATOS HABITUALES.
    $("#añadirHabituales").click(function () {
        const platosFavoritos = ["A15", "A20", "A22", "A43", "A50", "A53", "A57", "A67", "A76"];
        var pedidoHabitual = "";

        $("#pInfoSeleccionPlatos").hide();

        var arrayNumPlatos = [];

        // Selecciona todas las etiquetas <b> dentro del div con id="divPedidos"
        $("#divPedidos b").each(function () {
            arrayNumPlatos.push($(this).text());
        });

        for (let i = 0; i < platosFavoritos.length; i++) {
            if (!arrayNumPlatos.includes(platosFavoritos[i])) {
                pedidoHabitual += "<li id='pedido" + i + "' class='list-group-item' ><span class='spanPlatoCant'><b>" + platosFavoritos[i] + "</b> - " + "<input class='form-control inputCantPlato' type='number' inputmode='numeric' value='1' step='1' min='1' max='99' onkeypress='return isNumeric(event)' oninput='maxLengthCheck(this)' onchange='minCantValue(this)'>" + mapMenu.get(platosFavoritos[i]) + "</span><div><button class='btn btn-sm bg-transparent align-self-end my-auto btnImagenPlato' title='Buscar plato.'><i class='bi bi-image'></i></button><button class='btn bg-transparent btnEliminarPedido' title='Eliminar pedido.'><i class='bi bi-x-lg'></i></button></div></li>";
            }
        }

        $("#listaPedidos").append(pedidoHabitual);
        document.getElementById("textoTotalPedidos").innerHTML = "Platos seleccionados: <b>" + $("#listaPedidos li").length + "</b>";

        $("#divComplementariaPedidos").show();

        // Desplazar la vista hasta el div.
        var posicionDiv = $("#divListaPedidos").offset().top - 10;
        $("html, body").animate({ scrollTop: posicionDiv }, 0);


    });

    //FUNCION PARA EL EASTER EGG.
    $("body").on("click", "#spanEE", function () {
        const frasesEE = ["¿Cavani te apetece japones o japonesa?", "Cavani la tiene chicken little.", "Cavani la tiene como un nigiri.", "Hassy.", "No cualquier harina hace hot cakes 🥞.", "#BarbaDura TATA V6 3.2 GASOLINE 4MATIC."];
        let numeroAleatorio = Math.floor(Math.random() * frasesEE.length);

        const ahora = new Date().getTime();

        if (ahora - ultimoTiempoClick < 3000) {
            contadorClicks++;
            if (contadorClicks >= 5) {
                alert(frasesEE[numeroAleatorio]);
                //$("#tooltipEE").tooltipster("open");
                contadorClicks = 0;
            }
        } else {
            contadorClicks = 1;
        }
        ultimoTiempoClick = ahora;
    });

    //LISTENER PARA ABRIR UN MODAL CON EL LISTADO DE PLATOS SELECCIONADO EN "MODO DISCRETO".
    $("#divListaPedidos").on("click", "span#totalPedidos", function () {


        let listadoPedidos = "";
        const elementosLista = $("#listaPedidos li");

        elementosLista.each(function (index) {
            let textoSpan = $(this).find("span").text().replace(/[^A-Za-z0-9áéíóúÁÉÍÓÚ.,-:"'\(\)\s]/g, '');

            let cantidadPlato = $(this).find("input").val();
            cantidadPlato = " ~ (" + cantidadPlato + (cantidadPlato > 1 ? " uds." : "ud.") + ")";

            listadoPedidos += "<p class='pListadoPedidosModal'>" + textoSpan + cantidadPlato + "</p>";
        });

        $("#listadoPedidosModal").html(listadoPedidos);
        $("#totalPlatosModal").html("Total de platos pedidos: <b>" + $("#listaPedidos li").length + "</b>");

        $("#modalPedido").modal("show");
    });

    //LISTENER PARA VOLVER A LA PARTE SUPERIOR DEL MENU DE PLATOS.
    $("#btnPrincipioMenu").click(function () {
        $("#divTablaMenu").animate({ scrollTop: 0 }, 300, "swing");
    });

    //LISTENER PARA MOSTRAR BOTON VOLVER ARRIBA, AL HACER SCROLL EN EL DIV DEL MENU DE PLATOS.
    $("#divTablaMenu").on("scroll", function () {
        if ($(this).scrollTop() > 0) {
            $("#btnPrincipioMenu").fadeIn(100);
        } else {
            $("#btnPrincipioMenu").fadeOut(100);
        }
    });

    //ESTAS 2 FUNCIONES SIRVEN PARA CONTROLAR EL VALOR DEL INPUT DE LA CANTIDAD DEL PLATO.
    function maxLengthCheck(object) {
        if (object.value.length > object.max.length) {
            object.value = object.value.slice(0, object.max.length);
        }
    }

    function isNumeric(evt) {
        var theEvent = evt || window.event;
        var key = theEvent.keyCode || theEvent.which;
        key = String.fromCharCode(key);

        var regex = /^[0-9][0-9]?$/;
        if (!regex.test(key)) {
            theEvent.returnValue = false;
            if (theEvent.preventDefault) theEvent.preventDefault();
        }
    }

    function minCantValue(object) {
        if (object.value === "" || object.value === "0") {
            object.value = "1";
        }
    }

    $("#divListaPedidos").on("change", "input.inputCantPlato", function () {
        var value = $(this).val();
        value = value.replace(",", "").replace(".", "").replace("-", "");
        $(this).val(value);
    });

    //

    //ESTAS 3 FUNCIONES SON PARA EL FUNCIONAMIENTO DEL BOTON GO-UP.
    window.onscroll = function () {
        scrollFunction();
    };

    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            $("#btn-back-to-top").fadeIn(100);
        } else {
            $("#btn-back-to-top").fadeOut(100);
        }
    }

    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }
    //

    //ESTA FUNCION SE ENCARGA DE MOSTRAR LA FECHA Y HORA EN TIEMPO REAL.
    function actualizarReloj() {
        let fecha = new Date();

        //TIEMPO ACTUAL
        let horas = fecha.getHours();
        let minutos = fecha.getMinutes();
        let segundos = fecha.getSeconds();
        let horaActual = formatoHora(horas) + ":" + formatoHora(minutos) + ":" + formatoHora(segundos);

        //FECHA ACTUAL
        let dia = fecha.getDate();
        let mes = fecha.getMonth() + 1;
        let año = fecha.getFullYear();
        let fechaActual = formatoHora(dia) + "/" + formatoHora(mes) + "/" + año;

        $("#tiempoActual").html(fechaActual + " - " + horaActual);

        let tiempoRestante = "";

        // Crear objetos Date para las 12:00 PM y las 16:00 PM
        let horaMediodia1 = new Date();
        horaMediodia1.setHours(12);
        horaMediodia1.setMinutes(0);

        let horaMediodia2 = new Date();
        horaMediodia2.setHours(16);
        horaMediodia2.setMinutes(0);
        horaMediodia2.setSeconds(0);

        // Comparar la hora actual con las 12:00 PM y las 16:00 PM
        if (fecha.getTime() > horaMediodia1.getTime() && fecha.getTime() < horaMediodia2.getTime()) {

            // Calcular la diferencia de tiempo en segundos
            let diferenciaTiempo = horaMediodia2.getTime() - fecha.getTime();

            // Calcular la diferencia de tiempo en horas, minutos y segundos
            let horasRestantes = Math.floor(diferenciaTiempo / 1000 / 60 / 60);
            let minutosRestantes = Math.floor(diferenciaTiempo / 1000 / 60) % 60;
            let segundosRestantes = Math.floor(diferenciaTiempo / 1000) % 60;

            tiempoRestante = "Cierran a las <b>16:00</b>. <b>Tiempo restante:</b> " + horasRestantes + ":" + formatoHora(minutosRestantes) + ":" + formatoHora(segundosRestantes);
        } else {
            // Crear objetos Date para las 19:30 PM y las 24:00 PM
            let horaNoche1 = new Date();
            horaNoche1.setHours(19);
            horaNoche1.setMinutes(30);

            let horaNoche2 = new Date();
            horaNoche2.setHours(24);
            horaNoche2.setMinutes(0);
            horaNoche2.setSeconds(0);

            // Comparar la hora actual con las 19:30 PM y las 24:00 PM
            if (fecha.getTime() > horaNoche1.getTime() && fecha.getTime() < horaNoche2.getTime()) {

                // Calcular la diferencia de tiempo en segundos
                let diferenciaTiempo = horaNoche2.getTime() - fecha.getTime();

                // Calcular la diferencia de tiempo en horas, minutos y segundos
                let horasRestantes = Math.floor(diferenciaTiempo / 1000 / 60 / 60);
                let minutosRestantes = Math.floor(diferenciaTiempo / 1000 / 60) % 60;
                let segundosRestantes = Math.floor(diferenciaTiempo / 1000) % 60;

                tiempoRestante = "Cierran a las <b>00:00</b>. <b>Tiempo restante:</b> " + horasRestantes + ":" + formatoHora(minutosRestantes) + ":" + formatoHora(segundosRestantes);

            } else {
                tiempoRestante = "<b>Japonés cerrado.</b> ";

                if (fecha.getTime() < horaMediodia1.getTime() || fecha.getTime() > horaNoche2.getTime()) {
                    tiempoRestante += "Volverá a abrir a las <b>12:00</b>. 😞";
                } else if (fecha.getTime() > horaMediodia2.getTime()) {
                    tiempoRestante += "Volverá a abrir a las <b>19:30</b>. 😞";
                }
            }

        }

        $("#tiempoCierre").html(tiempoRestante);

        window.requestAnimationFrame(actualizarReloj);
    }

    // Formatear un valor numerico (horas, minutos, segundos) para que siempre tenga dos digitos.
    function formatoHora(valor) {
        if (valor < 10) {
            return "0" + valor;
        } else {
            return valor;
        }
    }

    actualizarReloj();




</script>

<script>
    $(document).ready(function () {

        var anchoOriginal = $('#imgMaki').css('width');
        var intervalId;
        var buttonReleased = true;

        // AUDIOS
        var aficion_CR7 = new Audio('audio/aficion_CR7.mp3');
        var tactical_nuke = new Audio('audio/tactical_nuke.mp3');

        $('#divContadorMaki').find('*').on('contextmenu', function (event) {
            event.preventDefault(); // Evita que se muestre el menú contextual
        });


        $('#imgMaki').click(function () {

            // Detener la animación actual y restaurar el tamaño original y el margen original
            $(this).stop().width(anchoOriginal);

            // Hacer vibrar el dispositivo móvil
            if (navigator.vibrate) {
                navigator.vibrate(100); // Vibrar durante 100 milisegundos
            }

            // Hacer la imagen un poco más pequeña y ajustar el margen para mantener el mismo espacio en la página
            $(this).animate({ width: '-=10px' }, 80).animate({ width: anchoOriginal }, 80);

            if (contador < 100) {
                // Incrementar el contador
                contador++;
                $('#contador').text(contador);
            }

            accionesContador();

        });

        // Función para decrementar el contador
        $('#btnDecrecer').click(function () {
            if (contador > 0) {
                contador--;
                $('#contador').text(contador);
            }

            if (contador != 100) {
                accionesContador();
            }
        });

        // Función para reiniciar el contador
        $('#btnReset').click(function () {
            contador = 0;
            $('#contador').text(contador);

            accionesContador();

        });

        // Función para decrementar el contador cuando se mantiene pulsado el botón
        $('#btnDecrecer').on('mousedown touchstart', function () {


            accionesContador();

            if (buttonReleased) {

                buttonReleased = false; // Indicar que se ha pulsado el botón
                // Temporizador de retraso para iniciar el decremento después de 1.5 segundos
                delayTimer = setTimeout(function () {

                    intervalId = setInterval(function () {
                        if (contador > 0) {
                            contador--;
                            $('#contador').text(contador);

                        }
                    }, 160); // Intervalo de decremento
                }, 220); // Retraso de 1.5 segundos
            }
        }).on('mouseup touchend', function () {
            clearTimeout(delayTimer); // Limpiar el temporizador de retraso
            clearInterval(intervalId); // Limpiar el intervalo de decremento
            buttonReleased = true; // Indicar que se ha soltado el botón

        });


        function accionesContador() {

            pausarAudios();

            if (contador === 30) {
                reproducirAudio(tactical_nuke);
            }
            else if (contador === 100) {
                reproducirAudio(aficion_CR7);
            }

            function pausarAudios() {
                tactical_nuke.pause();
                tactical_nuke.currentTime = 0;

                aficion_CR7.pause();
                aficion_CR7.currentTime = 0;
            }

            function reproducirAudio(audio) {
                // Verifica si el audio está reproduciéndose
                if (!audio.paused) {
                    audio.pause(); // Pausa el audio si ya está sonando
                    audio.currentTime = 0; // Reinicia la reproducción al principio
                }

                audio.play(); // Reproduce el audio
            }
        }



    });


</script>


</html>